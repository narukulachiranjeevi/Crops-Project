var app = angular.module('myapp',[]);
var mydata = [];
var date=[];
var fcv=[];
var sum=0;
var aadhar=[]
var avail=[];
app.controller('myctrl',function($scope,$http){
	$scope.exec=function(){
		$http({
			url:'/senddd',
			method:'get'
		}).then(function(success){
			$scope.daaa=success.data;
		},function(error){
			console.log(error);
		})
	};
	$scope.fun=function(val){
		if(val=="Yes"){
			$http({
				url:'/search',
				method:'post',
				data:localStorage.getItem('data')
			}).then(function(success){
				$scope.avail=success.data;
				localStorage.setItem('avail',JSON.stringify(success.data));
				if(success.data.length!==0){
					location.href="/avail";
				}
				else{
					location.href="/purchase"
				}
			},function(error){
				console.log(error);
			})
		}
		else{
			location.href="/fcv_user"
		}
	}
	$scope.getdata=function(){
		$http({
			url:'/senddata',
			method:'get'
		}).then(function(success){
			$scope.mydata=success.data;
		},function(error){
			console.log(error);
		})
	};
	$scope.send=function(val){
		$http({
			url:'/number',
			method:'post',
			data:val
		}).then(function(success){
			$scope.data=success.data;
		},function(error){
			console.log(error);
		})
	};
	$scope.senda=function(val){
		
		$http({
			url:'/aadharsend',
			method:'post',
			data:val
		}).then(function(success){
			$scope.aadhar=success.data;
			localStorage.setItem('aadharfcv',JSON.stringify(success.data));
		},function(error){
			console.log(error);
		})
	}
	$scope.funn=function(val){
		if(val=="Yes"){
			console.log(new Date());
			$http({
				url:'/searchh',
				method:'post',
				data:localStorage.getItem('aadharfcv')
			}).then(function(success){
				$scope.aadhardetails=success.data;
				localStorage.setItem('aadhardetails',JSON.stringify(success.data));
				if(success.data.length!==0){
					location.href="/purchasedetails";
				}
				else{
					location.href="/purchaseaadhar"
				}
			},function(error){
				console.log(error);
			})
		}
		else{
			location.href="/fcv_user"
		}
	}
});
app.controller("temp",function($scope){
	$scope.myfun=function(data){
		localStorage.setItem("data",JSON.stringify(data));
	}
});
app.controller("purchase",function($scope,$http){
	$scope.count=0;
	$scope.tbgrno=JSON.parse(localStorage.getItem("data"))[0].TBGRNO;
	$scope.send=function(val){
		 val.total=(val.qun*val.kgs);
		 val.tbgrno=$scope.tbgrno;
		 val.date=new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"});
		 $scope.count++;
		 val.count=$scope.count;
		$http({
			url:'/purdata',
			method:'post',
			data:val
		}).then(function(success){
			console.log('success');
		},function(error){
			console.log(error);
		})
	}
	
	$scope.save=function(val) {
		val.count=$scope.count;
		$http({
			method:'post',
			data:val,
			url:'/save'
		}).then(function(success){
			console.log('success');
		},function(error){
			console.log(error);
		})
		location.href="/fcv_user"
	}
});
app.controller('report',function($scope,$http){
	$scope.avail=JSON.parse(localStorage.getItem('avail'));
	$scope.aadhardetails=JSON.parse(localStorage.getItem('aadhardetails'));
	$scope.daa=function(val){
		val.end.setDate(val.end.getDate()+1)
		$http({
			method:'post',
			data:val,
			url:'/date'
		}).then(function(success){
			$scope.date=success.data;
			sum=0;
			angular.forEach($scope.date,function(val2,key){
				sum=sum+val2.total;
			});
			$scope.value=sum;
		},function(error){
			console.log(error);
		})
	}
	$scope.get=function(){
		$http({
			method:'get',
			url:'/getdata'
		}).then(function(success){
			$scope.fcv=success.data;
			sum=0;
			angular.forEach(success.data,function(val2,key){
				sum=sum+val2.total;
			});
			$scope.value=sum;
		},function(error){
			console.log(error);
		})
	}
});
app.controller("purchasea",function($scope,$http){
	$scope.count=0;
	$scope.aadhar=JSON.parse(localStorage.getItem("aadharfcv"))[0].aadhar;
	$scope.sendd=function(val){
		 val.total=(val.qun*val.kgs);
		 val.aadhar=JSON.parse(localStorage.getItem("aadharfcv"))[0].aadhar;
		 val.date=new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"});
		 $scope.count++;
		 val.count=$scope.count;
		$http({
			url:'/purdataa',
			method:'post',
			data:val
		}).then(function(success){
			console.log('success');
		},function(error){
			console.log(error);
		})
	}
	$scope.savee=function(val) {
		val.count=$scope.count;
		$http({
			method:'post',
			data:val,
			url:'/savee'
		}).then(function(success){
			console.log('success');
		},function(error){
			console.log(error);
		})
		location.href="/fcv_user"
	}
});